---
title: Using the API Key API
sidebar_label: Using the API
---

Zuplo runs a globally distributed API Key management service that scales to handle billions of daily key validation requests while maintaining low latency from any region around the world.

Management of API Keys and consumers [can be performed in the Zuplo Portal](./api-key-management.mdx) and for end-users in the Zuplo Developer Portal.

:::info

obtain an API Key for the Developer API, go to your account settings in the Zuplo Portal.

:::

## Models

The service contains three primary object: **Buckets**, **Consumers**, and **API Keys**.

The Consumer is the most important object. Each consumer is in a bucket.

### Buckets

Buckets are the top level group for this service. A bucket could be used with a single Zuplo environment or shared among multiple environments or projects.

Enterprise plan customers run complex configurations where buckets are shared across gateway projects or even accounts.

### Consumers

Consumers are the core of the API Key service. The consumer is the "identity" of any API Keys that are created.

### API Keys

A Consumer can have any number of API keys associated with it. Each API Key shares the same identity (for example Consumer) when authenticating with this service.

:::tip

In most cases, you wont manage API Keys directly.

:::

## Usage

This section explains common scenarios for managing API keys using the API.

All examples assume two environment variables are set (in your terminal, not inside Zuplo)

```bash
# Your Zuplo Account Name
export ACCOUNT_NAME=my-account
# Your bucket API URL (Found in Settings > Project Information)
export BUCKET_NAME=my-bucket
# Your Zuplo API Key (Found in Settings > Zuplo API Keys)
export ZAPI_KEY=zpka_YOUR_API_KEY
```

### Creating a Consumer with a Key

When creating a new Consumer, it's a good idea to include some useful metadata like the `organizationId` or a particular `plan` that's associated with that user.

Tags are used for querying the consumers later. It's often useful to store some external identifier that links this consumer to your internal data as a tag.

```shell
curl \
  https://dev.zuplo.com/v1/accounts/$ACCOUNT_NAME/key-buckets/$BUCKET_NAME/consumers?with-api-key=true \
  --request POST \
  --header "Content-type: application/json" \
  --header "Authorization: Bearer $API_KEY" \
  --data @- << EOF
{
  "name": "my-consumer",
  "description": "My Consumer",
  "metadata": {
    "orgId": 1234,
    "plan": "gold"
  },
  "tags": {
    "externalId": "acct_12345"
  }
}
EOF
```

The response will look like this:

```json
{
  "id": "csmr_sikZcE754kJu17X8yahPFO8J",
  "name": "my-consumer",
  "description": "My Consumer",
  "createdOn": "2023-02-03T21:33:17.067Z",
  "updatedOn": "2023-02-03T21:33:17.067Z",
  "tags": {
    "externalId": "acct_12345"
  },
  "metadata": {
    "orgId": 1234,
    "plan": "gold"
  },
  "apiKeys": [
    {
      "id": "key_AM7eAiR0BiaXTam951XmC9kK",
      "createdOn": "2023-06-19T17:32:17.737Z",
      "updatedOn": "2023-06-19T17:32:17.737Z",
      "expiresOn": null,
      "key": "zpka_d67b7e241bb948758f415b79aa8exxxx_2efbxxxx"
    }
  ]
}
```

You can use this API Key to call your Zuplo API Gateway that's protected by the [API Key Authentication](/docs/policies/api-key-inbound) policy.

### Query Consumers with API Keys By Tags

```shell
export ORG_ID=1234
curl \
  https://dev.zuplo.com/v1/accounts/$ACCOUNT_NAME/key-buckets/$BUCKET_NAME/consumers/?include-api-keys=true&key-format=visible&tag.orgId=$ORG_ID \
  --header "Authorization: Bearer $API_KEY"
```

The response will look like this:

```json
{
  "data": [
    {
      "id": "csmr_sikZcE754kJu17X8yahPFO8J",
      "name": "my-consumer",
      "description": "My Consumer",
      "createdOn": "2023-02-03T21:33:17.067Z",
      "updatedOn": "2023-02-03T21:33:17.067Z",
      "tags": {
        "externalId": "acct_12345"
      },
      "metadata": {
        "orgId": 1234,
        "plan": "gold"
      },
      "apiKeys": [
        {
          "id": "key_AM7eAiR0BiaXTam951XmC9kK",
          "createdOn": "2023-06-19T17:32:17.737Z",
          "updatedOn": "2023-06-19T17:32:17.737Z",
          "expiresOn": null,
          "key": "zpka_d67b7e241bb948758f415b79aa8exxxx_2efbxxxx"
        }
      ]
    }
  ],
  "offset": 0,
  "limit": 1000
}
```

### Roll a Consumer's Keys

Sometimes you will want to create a new key and expire the current keys.

:::tip{title="Tags for Request Authorization"}

One useful feature of the API Key service is that most requests can have `tags` added to the query parameter even if they aren't get requests.

:::

The following call with set all existing keys to have the expiration date set in the request body and will create a new key without an expiration.

```shell
export ORG_ID=1234
export CONSUMER_NAME=my-consumer
curl \
  https://dev.zuplo.com/v1/accounts/$ACCOUNT_NAME/key-buckets/$BUCKET_NAME/consumers/$CONSUMER_NAME/roll-key?tag.orgId=$ORG_ID \
  --request POST \
  --header "Authorization: Bearer $API_KEY"
  --data '{"expiresOn":"2023-04-18"}'
```

## Reference

The full API Reference for the API Service is hosted using a Zuplo developer portal at [https://dev.zuplo.com/docs/](https://dev.zuplo.com/docs/).
